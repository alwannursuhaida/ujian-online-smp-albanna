<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SMP ALBANNA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Montserrat', sans-serif; }</style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="admin-app" class="flex min-h-screen">
        
        <!-- SIDEBAR -->
        <div class="w-64 bg-blue-900 text-white flex flex-col">
            <div class="p-6 text-center border-b border-blue-800">
                <h1 class="text-xl font-bold">ADMIN PANEL</h1>
                <p class="text-xs text-blue-200">Bank Soal SMP Albanna</p>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4">
                <h3 class="text-xs font-bold text-blue-300 uppercase mb-2">Daftar Paket Soal</h3>
                
                <div v-if="bankSoal.length === 0" class="text-sm text-gray-400 italic">Belum ada soal masuk.</div>

                <ul class="space-y-2">
                    <li v-for="paket in bankSoal" :key="paket.id">
                        <button @click="pilihPaket(paket)" 
                            :class="['w-full text-left p-3 rounded text-sm transition', activePaket && activePaket.id === paket.id ? 'bg-white text-blue-900 font-bold shadow' : 'hover:bg-blue-800 text-blue-100']">
                            <div class="font-bold">{{ paket.config.mapel }}</div>
                            <div class="text-xs opacity-80">{{ paket.config.guru }}</div>
                            <div class="text-xs mt-1 text-right">{{ formatDate(paket.tanggal_buat) }}</div>
                        </button>
                    </li>
                </ul>
            </div>
            
            <div class="p-4 border-t border-blue-800 text-xs text-center text-blue-300">
                Sistem Database Lokal
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="flex-1 p-8 overflow-y-auto h-screen">
            
            <!-- Jika belum pilih paket -->
            <div v-if="!activePaket" class="h-full flex flex-col items-center justify-center text-gray-400">
                <i class="fas fa-folder-open fa-5x mb-4"></i>
                <p class="text-xl">Pilih paket soal di sebelah kiri untuk melihat detail.</p>
            </div>

            <!-- Detail Paket -->
            <div v-else>
                <div class="flex justify-between items-start mb-6 border-b pb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">{{ activePaket.config.mapel }}</h1>
                        <p class="text-gray-600">Guru: <span class="font-bold">{{ activePaket.config.guru }}</span> | Durasi: {{ activePaket.config.durasi }} Menit</p>
                        <p class="text-sm text-gray-500">Tanggal Ujian: {{ activePaket.config.tanggal }}</p>
                    </div>
                    <div>
                        <button @click="hapusPaket(activePaket.id)" class="bg-red-100 text-red-600 px-4 py-2 rounded hover:bg-red-200 transition font-bold text-sm">
                            <i class="fas fa-trash mr-1"></i> HAPUS PAKET
                        </button>
                    </div>
                </div>

                <!-- Statistik -->
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-xs text-gray-500 font-bold uppercase">Total Soal</h3>
                        <p class="text-2xl font-bold text-blue-900">{{ activePaket.soal.length }}</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-xs text-gray-500 font-bold uppercase">Pilgan</h3>
                        <p class="text-2xl font-bold text-blue-900">{{ hitungTipe('PG') }}</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-xs text-gray-500 font-bold uppercase">Uraian/Esai</h3>
                        <p class="text-2xl font-bold text-blue-900">{{ hitungTipe('URAIAN') + hitungTipe('ESAI') }}</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-xs text-gray-500 font-bold uppercase">Lainnya</h3>
                        <p class="text-2xl font-bold text-blue-900">{{ hitungTipe('BS') + hitungTipe('PG_KOMPLEKS') }}</p>
                    </div>
                </div>

                <!-- List Soal Preview -->
                <div class="bg-white rounded shadow overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-100 border-b">
                            <tr>
                                <th class="p-3 w-10 text-center font-bold text-gray-600">No</th>
                                <th class="p-3 font-bold text-gray-600">Pertanyaan</th>
                                <th class="p-3 w-32 font-bold text-gray-600">Tipe</th>
                                <th class="p-3 w-40 font-bold text-gray-600">Kunci</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(q, idx) in activePaket.soal" :key="idx" class="border-b hover:bg-gray-50">
                                <td class="p-3 text-center text-gray-500">{{ idx + 1 }}</td>
                                <td class="p-3">
                                    <div v-if="q.image" class="mb-2"><img :src="q.image" class="h-10 border rounded"></div>
                                    <div class="text-sm font-semibold text-gray-800">{{ q.text }}</div>
                                    
                                    <!-- Preview Opsi PG -->
                                    <div v-if="q.type === 'PG'" class="text-xs text-gray-500 mt-1 grid grid-cols-2 gap-1">
                                        <span v-for="(val, key) in q.options" :class="key === q.answer ? 'text-green-600 font-bold' : ''">
                                            {{ key }}. {{ val }}
                                        </span>
                                    </div>
                                </td>
                                <td class="p-3">
                                    <span class="text-xs px-2 py-1 rounded bg-blue-50 text-blue-800 font-bold">{{ q.type }}</span>
                                </td>
                                <td class="p-3 text-sm font-mono text-green-700 font-bold">
                                    <span v-if="['PG','BS'].includes(q.type)">{{ q.answer }}</span>
                                    <span v-else-if="q.type === 'PG_KOMPLEKS'">Multi</span>
                                    <span v-else class="text-xs text-gray-400 italic">Lihat Detail</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    bankSoal: [],
                    activePaket: null
                }
            },
            mounted() {
                this.loadData();
            },
            methods: {
                loadData() {
                    const data = localStorage.getItem('smp_albanna_bank_soal');
                    if (data) {
                        this.bankSoal = JSON.parse(data).reverse(); // Yang terbaru diatas
                    }
                },
                pilihPaket(paket) {
                    this.activePaket = paket;
                },
                hapusPaket(id) {
                    if(confirm("Yakin ingin menghapus paket soal ini dari sistem?")) {
                        this.bankSoal = this.bankSoal.filter(p => p.id !== id);
                        localStorage.setItem('smp_albanna_bank_soal', JSON.stringify(this.bankSoal));
                        this.activePaket = null;
                        alert("Paket soal dihapus.");
                    }
                },
                hitungTipe(type) {
                    if(!this.activePaket) return 0;
                    return this.activePaket.soal.filter(s => s.type === type).length;
                },
                formatDate(str) {
                    // Format tanggal sederhana
                    return str.split(',')[0]; 
                }
            }
        }).mount('#admin-app');
    </script>
</body>
</html>
