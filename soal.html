<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Soal Guru - SMP ALBANNA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        /* Transisi halus */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-20">

    <div id="app" class="max-w-5xl mx-auto pt-8 px-4">

        <!-- HEADER -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-900">INPUT SOAL & KUNCI JAWABAN</h1>
            <p class="text-gray-600 font-semibold">SMP ALBANNA</p>
        </header>

        <!-- PROGRESS BAR -->
        <div class="flex justify-between items-center mb-8 relative px-10">
            <div class="absolute left-0 top-1/2 w-full h-1 bg-gray-300 -z-10"></div>
            <div :class="['w-10 h-10 rounded-full flex items-center justify-center font-bold text-white transition-all', step >= 1 ? 'bg-blue-900 scale-110' : 'bg-gray-400']">1</div>
            <div :class="['w-10 h-10 rounded-full flex items-center justify-center font-bold text-white transition-all', step >= 2 ? 'bg-blue-900 scale-110' : 'bg-gray-400']">2</div>
            <div :class="['w-10 h-10 rounded-full flex items-center justify-center font-bold text-white transition-all', step >= 3 ? 'bg-blue-900 scale-110' : 'bg-gray-400']">3</div>
        </div>
        <div class="flex justify-between text-xs font-bold text-gray-500 px-4 -mt-6 mb-8">
            <span>Setup Ujian</span>
            <span>Input Soal</span>
            <span>Kunci Jawaban</span>
        </div>

        <!-- STEP 1: SETUP UJIAN -->
        <div v-if="step === 1" class="bg-white p-8 rounded-lg shadow-lg max-w-2xl mx-auto border-t-8 border-blue-900">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Identitas Ujian</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Mata Pelajaran</label>
                    <select v-model="config.mapel" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-900 outline-none">
                        <option value="" disabled>-- Pilih Mapel --</option>
                        <optgroup label="Kelompok A (MTK, IPA)">
                            <option value="MATEMATIKA">MATEMATIKA</option>
                            <option value="IPA">IPA</option>
                        </optgroup>
                        <optgroup label="Kelompok B (Bahasa)">
                            <option value="BAHASA INGGRIS">BAHASA INGGRIS</option>
                            <option value="BAHASA INDONESIA">BAHASA INDONESIA</option>
                        </optgroup>
                        <optgroup label="Kelompok C (Muatan Lokal/Agama)">
                            <option value="BAHASA BALI">BAHASA BALI</option>
                            <option value="SENI BUDAYA">SENI BUDAYA</option>
                            <option value="BAHASA ARAB">BAHASA ARAB</option>
                        </optgroup>
                        <optgroup label="Kelompok D (Lainnya)">
                            <option value="PJOK">PJOK (PENJAS)</option>
                            <option value="IPS">IPS</option>
                            <option value="PAI">AGAMA ISLAM (PAI)</option>
                            <option value="INFORMATIKA">INFORMATIKA</option>
                        </optgroup>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Tanggal Pelaksanaan</label>
                    <input type="date" v-model="config.tanggal" class="w-full p-3 border rounded-lg bg-gray-50">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Waktu Pengerjaan (Menit)</label>
                    <input type="number" v-model="config.durasi" class="w-full p-3 border rounded-lg bg-gray-50" placeholder="Contoh: 90">
                </div>
            </div>

            <button @click="generateTemplate" class="w-full mt-8 bg-blue-900 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition shadow-lg">
                BUAT SLOT SOAL <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>

        <!-- STEP 2: INPUT SOAL -->
        <div v-if="step === 2">
            <div class="sticky top-0 z-40 bg-white p-4 shadow mb-6 rounded flex justify-between items-center border-l-4 border-blue-900">
                <div>
                    <h2 class="font-bold text-xl text-blue-900">{{ config.mapel }}</h2>
                    <span class="text-xs text-gray-500">Total Slot: {{ questions.length }} Butir</span>
                </div>
                <div class="flex gap-2">
                    <button @click="step = 1" class="px-4 py-2 text-sm text-gray-500 hover:text-red-500">Batal</button>
                    <button @click="lanjutKeKunci" class="px-6 py-2 bg-green-600 text-white rounded font-bold hover:bg-green-700 shadow">
                        INPUT KUNCI JAWABAN <i class="fas fa-check ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Loop Soal -->
            <div v-for="(q, index) in questions" :key="index" class="bg-white p-6 rounded-lg shadow-md mb-6 border border-gray-200">
                
                <!-- Header Soal -->
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <span class="bg-blue-100 text-blue-900 px-3 py-1 rounded font-bold text-sm">
                        No. {{ index + 1 }} - {{ q.typeLabel }}
                    </span>
                    <span class="text-sm font-bold text-gray-500">Bobot: {{ q.poin }} Poin</span>
                </div>

                <!-- Input Pertanyaan -->
                <div class="mb-4">
                    <label class="block text-sm font-bold text-gray-700 mb-1">Pertanyaan</label>
                    <!-- Fitur Upload Gambar Soal -->
                    <div class="mb-2">
                        <input type="file" @change="handleImageUpload($event, index)" class="text-xs text-gray-500">
                        <img v-if="q.image" :src="q.image" class="mt-2 h-24 object-contain border p-1 rounded">
                    </div>
                    <textarea v-model="q.text" rows="3" class="w-full p-3 border rounded focus:ring-1 focus:ring-blue-900 bg-gray-50" placeholder="Tulis soal di sini..."></textarea>
                </div>

                <!-- AREA INPUT OPSI BERDASARKAN TIPE -->
                
                <!-- 1. PILIHAN GANDA (PG) -->
                <div v-if="q.type === 'PG'" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div v-for="opt in ['A', 'B', 'C', 'D']" :key="opt" class="flex items-center gap-2">
                        <span class="font-bold w-6 text-center">{{ opt }}.</span>
                        <input v-model="q.options[opt]" type="text" class="w-full p-2 border rounded" :placeholder="'Opsi ' + opt">
                    </div>
                </div>

                <!-- 2. PG KOMPLEKS -->
                <div v-if="q.type === 'PG_KOMPLEKS'" class="bg-yellow-50 p-3 rounded text-sm text-yellow-800 mb-2">
                    <i class="fas fa-info-circle"></i> Tuliskan opsi jawaban. Siswa bisa memilih lebih dari satu.
                    <div class="grid grid-cols-1 gap-2 mt-2">
                        <div v-for="(opt, i) in q.options" :key="i" class="flex items-center gap-2">
                            <input type="checkbox" disabled class="w-4 h-4">
                            <input v-model="q.options[i].text" type="text" class="w-full p-2 border rounded bg-white" placeholder="Tulis pernyataan opsi...">
                        </div>
                    </div>
                </div>

                <!-- 3. BENAR SALAH -->
                <div v-if="q.type === 'BS'" class="bg-gray-50 p-3 rounded text-sm text-gray-500 text-center">
                    Siswa akan memilih <strong>Benar</strong> atau <strong>Salah</strong>. (Tidak perlu input opsi).
                </div>

                <!-- 4. URAIAN / ESAI -->
                <div v-if="['URAIAN', 'ESAI'].includes(q.type)" class="bg-gray-50 p-3 rounded text-sm text-gray-500 text-center">
                    Siswa akan mengetik jawaban panjang.
                </div>

            </div>

            <!-- Tombol Bottom -->
            <div class="flex justify-center pb-10">
                <button @click="lanjutKeKunci" class="px-10 py-4 bg-blue-900 text-white text-xl rounded-full font-bold hover:bg-blue-800 shadow-xl transition transform hover:scale-105">
                    SELESAI INPUT SOAL & LANJUT <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- STEP 3: INPUT KUNCI JAWABAN -->
        <div v-if="step === 3">
            <div class="sticky top-0 z-40 bg-green-50 p-4 shadow mb-6 rounded flex justify-between items-center border-l-4 border-green-600">
                <div>
                    <h2 class="font-bold text-xl text-green-800">KUNCI JAWABAN</h2>
                    <span class="text-xs text-gray-600">Pastikan kunci jawaban benar.</span>
                </div>
                <button @click="step = 2" class="text-sm text-gray-500 hover:text-green-700 font-bold">
                    <i class="fas fa-arrow-left"></i> KEMBALI KE SOAL
                </button>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <div v-for="(q, index) in questions" :key="index" class="bg-white p-4 rounded shadow border-l-4 border-green-500">
                    <div class="mb-2 text-sm text-gray-800 font-semibold">
                        <span class="bg-gray-200 px-2 py-1 rounded mr-2">No. {{ index + 1 }}</span>
                        <span v-if="q.text" class="italic">"{{ q.text.substring(0, 50) }}..."</span>
                        <span v-else class="text-red-400 italic">(Soal belum diisi)</span>
                    </div>

                    <!-- INPUT KUNCI BERDASARKAN TIPE -->

                    <!-- KUNCI PG -->
                    <div v-if="q.type === 'PG'" class="flex gap-4 mt-2">
                        <label v-for="opt in ['A', 'B', 'C', 'D']" :key="opt" class="flex items-center gap-1 cursor-pointer hover:bg-green-50 px-2 py-1 rounded">
                            <input type="radio" :name="'kunci-'+index" :value="opt" v-model="q.answer" class="w-5 h-5 text-green-600">
                            <span class="font-bold">{{ opt }}</span>
                        </label>
                    </div>

                    <!-- KUNCI PG KOMPLEKS (Multi Checkbox) -->
                    <div v-if="q.type === 'PG_KOMPLEKS'" class="mt-2">
                        <p class="text-xs text-gray-500 mb-1">Centang semua jawaban benar:</p>
                        <div class="flex flex-wrap gap-4">
                            <label v-for="(opt, i) in q.options" :key="i" class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" v-model="opt.isCorrect" class="w-4 h-4">
                                <span class="text-sm">{{ opt.text || 'Opsi ' + (i+1) }}</span>
                            </label>
                        </div>
                    </div>

                    <!-- KUNCI BENAR SALAH -->
                    <div v-if="q.type === 'BS'" class="flex gap-4 mt-2">
                        <label class="flex items-center gap-1 cursor-pointer">
                            <input type="radio" :name="'kunci-'+index" value="BENAR" v-model="q.answer" class="w-4 h-4"> Benar
                        </label>
                        <label class="flex items-center gap-1 cursor-pointer">
                            <input type="radio" :name="'kunci-'+index" value="SALAH" v-model="q.answer" class="w-4 h-4"> Salah
                        </label>
                    </div>

                    <!-- KUNCI URAIAN / ESAI -->
                    <div v-if="['URAIAN', 'ESAI'].includes(q.type)" class="mt-2">
                        <textarea v-model="q.answer" class="w-full p-2 text-sm border rounded bg-green-50" rows="2" placeholder="Tuliskan kata kunci jawaban / pedoman penskoran guru..."></textarea>
                    </div>

                </div>
            </div>

            <button @click="simpanDataFinal" class="w-full mt-8 bg-green-700 text-white py-4 rounded-lg font-bold hover:bg-green-800 shadow-xl text-xl mb-20">
                <i class="fas fa-save mr-2"></i> SIMPAN DATA KE SERVER
            </button>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    step: 1,
                    config: { mapel: '', tanggal: '', durasi: '' },
                    questions: []
                }
            },
            methods: {
                generateTemplate() {
                    if (!this.config.mapel) return alert("Pilih Mata Pelajaran dulu!");
                    
                    this.questions = []; // Reset
                    const m = this.config.mapel;
                    
                    // --- ATURAN DISTRIBUSI SOAL (HARDCODED) ---

                    // 1. KELOMPOK A (MTK, IPA)
                    if (['MATEMATIKA', 'IPA'].includes(m)) {
                        this.addSlots('PG', 25, 2);
                        this.addSlots('URAIAN', 10, 3);
                        this.addSlots('ESAI', 5, 4);
                    }
                    // 2. KELOMPOK B (B.INGGRIS, B.INDO)
                    else if (['BAHASA INGGRIS', 'BAHASA INDONESIA'].includes(m)) {
                        this.addSlots('PG', 20, 2);
                        this.addSlots('URAIAN', 10, 3);
                        this.addSlots('BS', 10, 1);
                        this.addSlots('ESAI', 5, 4);
                    }
                    // 3. KELOMPOK C (B.BALI, SENBUD, B.ARAB)
                    else if (['BAHASA BALI', 'SENI BUDAYA', 'BAHASA ARAB'].includes(m)) {
                        this.addSlots('PG', 40, 2);
                        this.addSlots('ESAI', 5, 4);
                    }
                    // 4. KELOMPOK D (PENJAS, IPS, PAI, INFOR)
                    else {
                        this.addSlots('PG', 25, 2);
                        this.addSlots('PG_KOMPLEKS', 5, 3); // 5 opsi per soal
                        this.addSlots('URAIAN', 5, 3);
                        this.addSlots('ESAI', 5, 4);
                    }

                    this.step = 2;
                    window.scrollTo(0,0);
                },

                // Helper untuk membuat slot kosong
                addSlots(type, count, points) {
                    let typeLabel = '';
                    if(type === 'PG') typeLabel = 'Pilihan Ganda';
                    if(type === 'PG_KOMPLEKS') typeLabel = 'Pilihan Ganda Kompleks';
                    if(type === 'URAIAN') typeLabel = 'Uraian Singkat';
                    if(type === 'ESAI') typeLabel = 'Esai Panjang';
                    if(type === 'BS') typeLabel = 'Benar / Salah';

                    for (let i = 0; i < count; i++) {
                        let qStructure = {
                            type: type,
                            typeLabel: typeLabel,
                            poin: points,
                            text: '',
                            image: null,
                            answer: '' // Untuk Kunci
                        };

                        // Struktur khusus Opsi
                        if (type === 'PG') {
                            qStructure.options = { A:'', B:'', C:'', D:'' };
                        } else if (type === 'PG_KOMPLEKS') {
                            // Default 4 opsi checklist
                            qStructure.options = [
                                { text: '', isCorrect: false },
                                { text: '', isCorrect: false },
                                { text: '', isCorrect: false },
                                { text: '', isCorrect: false }
                            ];
                        }

                        this.questions.push(qStructure);
                    }
                },

                handleImageUpload(event, index) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.questions[index].image = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },

                lanjutKeKunci() {
                    // Validasi sederhana
                    const emptyQ = this.questions.find(q => !q.text && !q.image);
                    if (emptyQ && !confirm("Ada soal yang teks/gambarnya masih kosong. Yakin lanjut?")) {
                        return;
                    }
                    this.step = 3;
                    window.scrollTo(0,0);
                },

                simpanDataFinal() {
                    // Di sini logika simpan ke Database / JSON Download
                    const dataFinal = {
                        config: this.config,
                        soal: this.questions
                    };
                    
                    console.log(dataFinal); // Debug
                    
                    // Simulasi Download JSON
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dataFinal));
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href", dataStr);
                    downloadAnchorNode.setAttribute("download", `BANK_SOAL_${this.config.mapel}.json`);
                    document.body.appendChild(downloadAnchorNode);
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();

                    alert("Data berhasil disimpan! (File JSON terunduh)");
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
